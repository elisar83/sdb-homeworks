# Домашнее задание к занятию «Резервное копирование баз данных» - Елизар Самсонов

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

#### Ответ:

---------------------------------------------------------------------
Подойдет полный (еженедельно) + дифференциальный (раз в день) бэкап .

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

В данном случае рекомендуется использовать полный (еженедельно) + инкрементный бэкап (ежечасно). Для повышения надежности можно делать полный бэкап чаще.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Такой вариант возможен при использовании репликации Master-сервера на Slave, который получает инкрементные бэкапы с Master-сервера в режиме реального времени. Время отката уменьшается почти до сетевого
лага. В случае краха Мастера можно оперативно назначить «новым Мастером» один из слейвов и перенаправить клиентов на него.

---------------------------------------------------------------------

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

#### Ответ:

---------------------------------------------------------------------
Пример команды для резервирования данных с использованием инструмента pg_dump:

```
pg_dump -U username -h hostname -p port -d dbname -F c -f backup_file.dump
```

Где:
- `username` - имя пользователя PostgreSQL с правами доступа к базе данных
- `hostname` - имя хоста, где запущен PostgreSQL сервер
- `port` - порт, на котором слушает PostgreSQL сервер (обычно 5432)
- `dbname` - имя базы данных, которую вы хотите резервировать
- `backup_file.dump` - путь и имя файла, в который будет сохранен резервный дамп

Пример команды для восстановления базы данных с использованием инструмента pg_restore:

```
pg_restore -U username -h hostname -p port -d dbname backup_file.dump
```

Где:
- `username` - имя пользователя PostgreSQL с правами доступа к базе данных
- `hostname` - имя хоста, где запущен PostgreSQL сервер
- `port` - порт, на котором слушает PostgreSQL сервер (обычно 5432)
- `dbname` - имя базы данных, в которую вы хотите восстановить данные
- `backup_file.dump` - путь и имя файла, содержащего резервный дамп

Для успешного выполнения команды восстановления базы данных необходимо предварительно создать пустую базу данных с указанным именем (`dbname`).

---------------------------------------------------------------------

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

#### Ответ:

---------------------------------------------------------------------
Да, процесс резервирования и восстановления базы данных в PostgreSQL можно автоматизировать с помощью скриптов и планировщика задач операционной системы.

Для автоматизации резервирования данных вы можете создать скрипт, который будет выполнять команду `pg_dump` и сохранять резервную копию в указанное место. Затем можно настроить планировщик задач операционной системы (например, cron в Unix-подобных системах), чтобы запускать этот скрипт регулярно по заданному расписанию.

---------------------------------------------------------------------


### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

#### Ответ:

---------------------------------------------------------------------
Для инкрементного резервного копирования в MySQL можно использовать команду `mysqldump`. Однако, в отличие от PostgreSQL, MySQL не поддерживает нативную возможность инкрементного резервного копирования. Вместо этого можно использовать опции команды `mysqldump` в сочетании с дополнительными средствами для определения измененных данных.

Один из способов выполнить инкрементное резервное копирование в MySQL - использовать двоичные журналы транзакций (binary log). Можно включить журналирование транзакций в конфигурационном файле MySQL и использовать команду `mysqlbinlog` для чтения и применения изменений из журналов.

Вот пример команды для создания инкрементной резервной копии MySQL с использованием двоичных журналов:

```bash
# Создание полного резервного копирования базы данных
mysqldump -u username -p --all-databases &gt; full_backup.sql

# Создание инкрементной резервной копии, используя binary log
mysqlbinlog --start-datetime="2023-01-01 00:00:00" --stop-datetime="2023-01-02 00:00:00" mysql-bin.00000X &gt;&gt; incremental_backup.sql
```

В этом примере мы сначала создаем полное резервное копирование базы данных с помощью `mysqldump`. Затем мы используем `mysqlbinlog` для чтения изменений из двоичных журналов в указанном временном интервале и добавляем их в инкрементную резервную копию.

Для успешного выполнения инкрементного резервного копирования нам необходимо включить журналирование транзакций в конфигурационном файле MySQL и правильно настроить параметры команд `mysqldump` и `mysqlbinlog` в соответствии с нашей конкретной ситуацией.

---------------------------------------------------------------------

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

#### Ответ:

---------------------------------------------------------------------

Использование реплики дает преимущество при необходимости моментального восстановления работоспособности БД - переход на Slave-сервер.
Если основная база данных испытывает высокую нагрузку на чтение, реплика может использоваться для распределения нагрузки, а также проведения дополнительных расчетов.

---------------------------------------------------------------------
